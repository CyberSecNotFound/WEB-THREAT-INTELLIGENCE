import re
import requests

def malware_scan(url):
    score = 0
    reasons = []

    try:
        html = requests.get(url, timeout=10).text.lower()
        patterns = open("data/malware_patterns.txt").read().splitlines()

        for p in patterns:
            if p in html:
                score += 25
                reasons.append(f"Pola malware: {p}")

        if re.search(r'iframe.*display:none', html):
            score += 40
            reasons.append("Hidden iframe terdeteksi")

        if "eval(" in html or "base64" in html:
            score += 30
            reasons.append("JavaScript obfuscation")

    except:
        score += 10
        reasons.append("Malware scan gagal")

    return score, reasons
